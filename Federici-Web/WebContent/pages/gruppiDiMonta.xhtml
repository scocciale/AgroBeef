<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui" template="/templates/layout.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


	<ui:define name="title">
		<h:outputText value="Gruppi di monta" />
	</ui:define>
	<ui:define name="title-desc">
		<h:outputText value="" />
	</ui:define>
	<ui:define name="content">
		<p:panel header="Gruppi di monta" closable="false" toggleable="false"
			widgetVar="gdmWidgetVar" id="gruppiDiMonta"
			style="margin-left: 10px ; margin-right: 10px">


			<div class="ui-g">
				<div class="ui-g-12 ui-md-6 ui-lg-6"
					style="border-right: solid 1px #ECECEC;">
					<div class="row">
						<div class="center-block center">
							<h:outputLabel value="Nuovo gruppo di monta"
								style="font-weight: bold; font-size: 1.2em!important; padding-bottom:5%!important; color: #7b7272;"
								styleClass="center-block" />
						</div>
					</div>

					<div class="ui-g-8">
						<div class="input-field">
							<p:inputText value="#{gdmMB.nuovoStoricoGruppoMonta.sgmNome}"
								onkeypress="if (event.keyCode == 13) return false;"
								maxlength="100" id="nomeNuovoStoricoGruppoMonta">
							</p:inputText>
							<label class="left-align" for="nomeNuovoStoricoGruppoMonta">
								<h:outputText value="Nome gruppo di monta" />
							</label>
						</div>
					</div>
					<div class="ui-g-4">
						<div class="input-field">
							<p:outputLabel for="dataApertura" value="Data di apertura"
								styleClass="left-align"
								style="font-size: 0.9rem !important;color: #888888;!important" />
							<p:calendar id="dataApertura"
								value="#{gdmMB.nuovoStoricoGruppoMonta.sgmDataApertura}"
								locale="it" navigator="true" styleClass="validate">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</p:calendar>
						</div>
					</div>



					<div class="ui-g-12">
						<div class="input-field">

							<p:autoComplete id="acAnimali"
								completeMethod="#{gdmMB.findFromParms}"
								value="#{gdmMB.valueAna}">
								<p:ajax update="showListAddedAnimal contForm:dlgAnimaleAddedYet"
									event="itemSelect" listener="#{gdmMB.addToGruppoDiMonta()}" />
							</p:autoComplete>

							<p:outputLabel value="Animali Disponibili"
								styleClass="left-align" for="acAnimali"
								style="font-size: 0.9rem !important; float:left!important;color: #888888;!important" />

							<p:selectOneListbox id="showListAddedAnimal" >
								<f:selectItems itemLabel="#{animale.anaNumMatricola}"
									itemValue="#{animale}" value="#{gdmMB.animaliAggiuntiView}"
									var="animale" />
							</p:selectOneListbox>

						</div>

						<p:outputLabel value="*: Toro" styleClass="left-align"
							style="font-size: 0.9rem !important; float:left!important;color: #888888;!important" />

					</div>


					<div class="row center-block center">

						<p:commandButton value="#{text['button.salva']}"
							style="float:right!important;margin-top: 6%!important;"
							actionListener="#{gdmMB.salvaGruppoDiMonta()}"
							id="salvaNewGruppo"
							rendered="#{!userMB.utente.profilo.proNome.equals('lettura')}"
							styleClass="width-100 waves-effect waves-light btn giallo_cdr"
							update="contForm:gruppiDiMonta " />
						<!-- contForm:pickListAnimali -->

						<p:tooltip for="salvaNewGruppo" value="#{text['tooltip.salva']}"
							position="top" />
					</div>
				</div>

				<div class="ui-g-12 ui-md-6 ui-lg-6">

					<div class="row">
						<p:dataTable id="gruppiDiMontaDt" var="sgdmVar"
							value="#{gdmMB.gruppiDiMontaList}"
							style="width:auto!important; float:right!important; "
							emptyMessage="#{text['label.emptyResult']}"
							currentPageReportTemplate="({currentPage} Di {totalPages})"
							rows="15" paginator="true"
							paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							rowsPerPageTemplate="5,10,15" paginatorPosition="bottom">

							<p:column width="5%">
								<p:rowToggler rendered="#{sgdmVar.sgmDataChiusura==null}" />
							</p:column>

							<p:column styleClass="center-align" width="26%"
								style="font-size: 1.2em!important" headerText="Nome">
								<h:outputText value="#{sgdmVar.sgmNome}" styleClass="left"
									style="font-size: 1.2em!important" />
							</p:column>

							<p:column styleClass="center-align" headerText="Data apertura"
								width="26%" style="font-size: 1.2em!important">
								<h:outputText value="#{sgdmVar.sgmDataApertura}"
									styleClass="left" style="font-size: 1.2em!important">
									<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>

							<p:column styleClass="center-align" headerText="Data chiusura"
								width="26%" style="font-size: 1.2em!important">
								<h:outputText value="#{sgdmVar.sgmDataChiusura}"
									styleClass="left" style="font-size: 1.2em!important">
									<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>
							<p:column styleClass="center-align">
								<p:commandButton value="Aggiungi animale"
									style="float:right!important;font-size: 1.1em!important"
									id="modificaGruppoDiMonta"
									rendered="#{!userMB.utente.profilo.proNome.equals('lettura')}"
									disabled="#{sgdmVar.sgmDataChiusura!=null}"
									action="#{gdmMB.showDialogAddAnimali(sgdmVar)}"
									styleClass="width-100 waves-effect waves-light btn giallo_cdr"
									update="contForm:addAnimaliInGruppo" />
								
								<p:tooltip for="modificaGruppoDiMonta"
									value="Aggiungi un animale o chiudi un gruppo" position="top" />
								<p:commandLink action="#{gdmMB.chiusuraGruppoMonta(sgdmVar)}"
									rendered="#{sgdmVar.sgmDataChiusura eq null and !userMB.utente.profilo.proNome.equals('lettura')}"
									update="gruppiDiMontaDt ">
									<p:graphicImage name="images/icons/delete_icon.png"
										style="height: 23px; width: 23px;" />
								</p:commandLink>
							</p:column>

							<p:rowExpansion>
								<p:dataTable id="gruppiDiMontasottoDt" var="gm"
									value="#{sgdmVar.gruppoMontas}"
									style="width:auto!important; float:right!important; "
									emptyMessage="#{text['label.emptyResult']}">

									<p:column styleClass="center-align" headerText="Matricola"
										style="font-size: 1.2em!important"
										sortBy="#{gm.anagrafica.anaNumMatricola}">
										<h:outputText value="#{gm.anagrafica.anaNumMatricola}"
											styleClass="left" style="font-size: 1.2em!important" />
									</p:column>
									<p:column styleClass="center-align"
										style="font-size: 1.2em!important"
										sortBy="#{gm.gmoDataInserimento}"
										headerText="Data inserimento">
										<h:outputText value="#{gm.gmoDataInserimento}"
											styleClass="left" style="font-size: 1.2em!important">
											<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
										</h:outputText>
									</p:column>
									<p:column styleClass="center-align" headerText="Toro"
										style="font-size: 1.2em!important">
										<h:outputText rendered="#{gm.anagrafica.anaFlagToro eq 1}"
											styleClass="fa fa-check" />
									</p:column>
									<p:column styleClass="center-align">
										<p:commandButton value="Elimina Animale"
											style="float:right!important;"
											rendered="#{!userMB.utente.profilo.proNome.equals('lettura')}"
											id="modificaAnimaleGruppoDiMonta"
											action="#{gdmMB.modificaAnimaleInGruppoDiMonta(sgdmVar,gm.gmoId)}"
											styleClass="width-100 waves-effect waves-light btn giallo_cdr"
											update="gruppiDiMontasottoDt " />
										<!-- contForm:pickListAnimali -->
										<p:tooltip for="modificaAnimaleGruppoDiMonta"
											value="Modifica l'animale nel gruppo di monta" position="top" />
									</p:column>
								</p:dataTable>

							</p:rowExpansion>

						</p:dataTable>
					</div>
				</div>
			</div>
		</p:panel>

		<p:dialog resizable="false" widgetVar="dlgAnimaleAddedYet" width="35%"
			id="dlgAnimaleAddedYet" closable="true" styleClass="dialogClass"
			style="box-shadow: 0px 1px 7px 0px rgba(0, 0, 0, 0.7) !important;">

			<div class="ui-g-12">
				<div class="row">
					<p:panelGrid columns="1" layout="grid">
						<h:outputText value="L'animale è stato già aggiunto alla lista." />
					</p:panelGrid>
				</div>
			</div>

		</p:dialog>

		<p:dialog id="confirmDialog" widgetVar="dlgEliminaToro"
			styleClass="dialogClass" minWidth="60" closable="true" modal="true"
			draggable="false" resizable="false">
			<f:facet name="header">
				<div class="row" style="margin-top: 2px !important;">
					<i class="fa fa-exclamation-triangle" aria-hidden="true"
						style="margin-right: 10px !important;"></i>
					<p:outputLabel value="#{text['mesage.warning']}"
						style="font-size: 16px !important;" />
				</div>
			</f:facet>

			<div class="row">
				<p:panelGrid columns="1" layout="grid">
					<h:outputText
						value="Se si elimina il toro il Gruppo di Monta verrà chiuso." />
					<h:outputText value="Si desidera procedere ?" />
				</p:panelGrid>
			</div>
			<div class="row">
				<p:panelGrid columns="2" layout="grid">
					<p:commandButton value="Si"
						actionListener="#{gdmMB.chiusuraGruppoMonta()}"
						onclick="PF('dlgEliminaToro').close();"
						update="gruppiDiMontaDt "
						styleClass="waves-effect waves-light rosso_cdr" icon="fa fa-check"
						style="margin-left:40%!important; width: 70px;" />
					<!-- contForm:pickListAnimali -->
					<p:commandButton value="No" onclick="PF('dlgEliminaToro').close();"
						styleClass="waves-effect waves-light rosso_cdr"
						style="margin-left:30%!important; width: 70px;" icon="fa fa-close"
						iconPos="20" />
				</p:panelGrid>
			</div>
		</p:dialog>

		<p:dialog id="addAnimaliInGruppo" styleClass="dialogClass"
			widgetVar="dlg2" minWidth="60" closable="true" modal="true"
			draggable="false" resizable="false">

			<div class="ui-g-12">
				<div class="input-field">

					<p:autoComplete id="acAnimaliEdit"
						completeMethod="#{gdmMB.findFromParms}" value="#{gdmMB.valueAna}">
						<p:ajax
							update="showListAddedAnimalEdit contForm:dlgAnimaleAddedYet"
							event="itemSelect" listener="#{gdmMB.addToEditGruppoDiMonta()}" />
					</p:autoComplete>

					<p:outputLabel value="Animali Disponibili" styleClass="left-align"
						for="acAnimaliEdit"
						style="font-size: 0.9rem !important; float:left!important;color: #888888;!important" />

					<p:selectOneListbox id="showListAddedAnimalEdit">
						<f:selectItems itemLabel="#{animale.anaNumMatricola}"
							itemValue="#{animale}" value="#{gdmMB.animaliEditAggiuntiView}"
							var="animale" />
					</p:selectOneListbox>

				</div>

				<p:outputLabel value="*: Toro" styleClass="left-align"
					style="font-size: 0.9rem !important; float:left!important;color: #888888;!important" />

			</div>

			<div class="row center-block center">

				<p:commandButton value="#{text['button.salva']}"
					style="float:right!important;margin-top: 6%!important;"
					actionListener="#{gdmMB.modificaGruppoDiMonta()}"
					id="aggiornaGruppo"
					styleClass="width-100 waves-effect waves-light btn giallo_cdr"
					update="contForm:gruppiDiMonta" oncomplete="PF('dlg2').hide();" />

				<p:tooltip for="aggiornaGruppo" value="#{text['tooltip.salva']}"
					position="top" />
			</div>
		</p:dialog>
	</ui:define>
</ui:composition>